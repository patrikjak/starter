import{f as G,c as h,s as C,g as i,a as V,D as x,b as E,r as X,d as Y,n as S,i as d,e as Z,h as W,j as b,k as ee,F as B,l as _,m as te,u as m,o as ne}from"./Form.js";const D="page",oe="pageSize",se="sort",ce="order",ie="deleteSort",u="filter",j="deleteFilters",le="pjutils/table/filter-form/{type}";function re(e){e.querySelectorAll(".pagination").forEach(n=>{ae(e,n)})}function ue(e){const t=e.querySelector(".pagination a.active");return parseInt(t.querySelector(".page-number").textContent)}function ae(e,t){t.querySelectorAll(".link").forEach(o=>{o.addEventListener("click",async function(s){s.preventDefault(),fe(o)&&a(e,{page:de(o.getAttribute("href"))})})})}function de(e){const t=G(D,e);return t===null?null:parseInt(t)}function fe(e){return!e.classList.contains("active")&&!e.classList.contains("disabled")}function F(e=document){e.querySelectorAll(".pj-dropdown").forEach(function(t){I(t),me(t),pe(t),window.addEventListener("resize",function(){I(t)})})}function p(e){return i(e.querySelector(".chosen"),"value")}function me(e){const t=e.querySelector(".arrow-wrapper");e.querySelector(".chosen").addEventListener("click",function(){t.querySelector(".arrow").classList.contains("up")||(ye(e),setTimeout(function(){he(e)},0))})}function he(e){document.addEventListener("click",function t(n){n.target instanceof Element&&(H(e),document.removeEventListener("click",t))})}function pe(e){e.querySelectorAll(".all-items .pj-dropdown-item").forEach(function(n){n.addEventListener("click",function(){const o=e.querySelector(".chosen"),s=i(o,"value"),c=i(n,"value");o.querySelector(".label").textContent=n.textContent,V(o,"value",c),H(e),s!==c&&e.dispatchEvent(new Event("change"))})})}function H(e){const t=e.querySelector(".arrow"),n=e.querySelector(".all-items");t.classList.add("down"),t.classList.remove("up"),n.classList.add(E),X(n,[x,E,"show"])}function ye(e){const t=e.querySelector(".arrow"),n=e.querySelector(".all-items");t.classList.remove("down"),t.classList.add("up"),n.classList.add(x,"show"),n.classList.remove(E)}function I(e){const t=h("div",null,{class:["hidden-items"]});e.querySelectorAll(".all-items .pj-dropdown-item").forEach(function(c){t.appendChild(c.cloneNode(!0))}),ge(),C(t);const o=t.scrollWidth+54,s=e.querySelector(".dropdown-wrapper");s.style.width=`${o}px`}function ge(e=document){e.querySelectorAll(".hidden-items").forEach(function(t){t.remove()})}function ve(e){const t=e.querySelector(".page-size");if(!t)return;const n=t.querySelector(".pj-dropdown");n.addEventListener("change",async function(){a(e,{pageSize:parseInt(p(n))})})}function Se(e){const n=e.querySelector(".page-size").querySelector(".pj-dropdown");return parseInt(p(n))}const O=new Set;function be(e){const t=e.querySelector("thead .pj-checkbox input"),n=e.querySelectorAll("tbody .pj-checkbox input");t===null||n.length===0||(t.checked=w(n),ke(t),$e(t,n),je(e))}function w(e){for(const t of e)if(t.checked===!1)return!1;return!0}function we(e){const t=y(e);if(t.length===0)return;const n=document.querySelector(`.pj-table-wrapper#${e}`),o=n.querySelector("thead .pj-checkbox input"),s=n.querySelectorAll("tbody .pj-checkbox input");s.forEach(c=>{const l=c.closest("tr").id;t.includes(l)&&(c.checked=!0,N(c,!0))}),w(s)&&(o.checked=!0)}function k(e){const t=e.querySelector(".bulk-actions-wrapper");t!==null&&(U(e.id)>0?t.classList.remove("hidden"):t.classList.add("hidden"),Ae(e))}function ke(e){const t=e.closest(".pj-table-wrapper");e.closest(".pj-checkbox").addEventListener("click",()=>{const n=t.querySelectorAll("tbody .pj-checkbox input");qe(e,n)})}function $e(e,t){const n=e.closest(".pj-table-wrapper");t.forEach(o=>{o.closest(".pj-checkbox").addEventListener("click",()=>{A(o,!o.checked),k(n),e.checked=w(t)})})}function qe(e,t){const n=e.closest(".pj-table-wrapper"),o=w(t);e.checked=!o,t.forEach(s=>{A(s,!o)}),k(n)}function N(e,t){const n=e.closest("tr");t?n.classList.add("active"):n.classList.remove("active")}function A(e,t){Ee(e,t),Le(e)}function Ee(e,t){e!==null&&(e.checked=t,N(e,t))}function U(e){return y(e).length}function Le(e){const t=e.closest(".pj-table-wrapper").id,n=e.checked,o=e.closest("tr").id;n?Ce(t,o):Fe(t,o)}function Ce(e,t){const n=y(e);n.includes(t)||(n.push(t),sessionStorage.setItem(e,JSON.stringify(n)))}function Fe(e,t){const n=y(e),o=n.indexOf(t);o!==-1&&n.splice(o,1),sessionStorage.setItem(e,JSON.stringify(n))}function Ae(e){const t=e.querySelector(".bulk-actions-wrapper .selected .count");t!==null&&(t.textContent=U(e.id).toString())}function y(e){return JSON.parse(sessionStorage.getItem(e)||"[]")}function Te(e){sessionStorage.removeItem(e)}function je(e){const t=e.querySelector(".bulk-actions-wrapper");if(t===null)return;t.querySelectorAll(".bulk-action button").forEach(o=>{O.has(o)||(O.add(o),o.addEventListener("click",function(){Ie(o,e)}))})}function Ie(e,t){const n=y(t.id);if(n.length===0)return;const o=i(e,"action"),s=i(e,"method").toLowerCase();Y(o,s,Oe(n)).then(c=>{Pe(c,t,n)}).catch(c=>{console.log(c),S(c?.data?.message??d.t("errors.default.message"),"Ooops!","error")})}function Oe(e){const t=new FormData;return e.forEach(n=>{t.append("bulkActionsIds[]",n)}),t}function Pe(e,t,n){const o=t.querySelector("thead .pj-checkbox input");o.checked=!1,n.forEach(s=>{t.querySelector(`tr[id='${s}'] .pj-checkbox input`)!==null&&A(t.querySelector(`tr[id='${s}'] .pj-checkbox input`),!1)}),Te(t.id),k(t),S(e.message,"Super","success")}function Me(e){e.querySelectorAll(".table-options .controller").forEach(n=>{n.addEventListener("click",function(){xe(e),Be(this),_e(this)})})}function R(e){e.classList.remove("opened")}function xe(e){e.querySelectorAll(".table-options .controller").forEach(n=>{R(n)})}function Be(e){e.classList.add("opened")}function _e(e){document.addEventListener("click",function t(n){if(!(n.target instanceof Element))return;const o=n.target.closest(".controller")!==null,s=n.target.closest(".overlay")!==null;o||s||(R(e),document.removeEventListener("click",t))})}function De(e){e.querySelector(".table-actions")&&e.querySelectorAll("tr td.actions").forEach(n=>{n.querySelector(".hellip").addEventListener("click",()=>{Ne(n,e.querySelector(".table-actions"))})})}function He(e){const t=e.querySelector(".table-actions");t!==null&&Z(t,e.querySelector(".pj-table"))}function Ne(e,t){t.style.display="inline-block",t.style.position="absolute",e.closest("tr").classList.add("active-actions"),Ue(e,t),Re(e,t);const o=e.closest(".table-wrapper"),s=o.clientWidth,c=e.getBoundingClientRect(),l=t.getBoundingClientRect(),r=o.getBoundingClientRect(),g=s-c.width-l.width;t.style.top=c.top-r.top+c.height/2/2+"px",t.style.left=g+"px",setTimeout(()=>{Qe(e,t)},0)}function Ue(e,t){const n=e.closest("tr"),o=i(n,"hidden-actions");let s=[];o!==null&&o!==""&&(s=o.split(",")),t.querySelectorAll(".action").forEach(l=>{if(W(s)){l.style.display="flex";return}for(const r of s)l.style.display=l.classList.contains(r)?"none":"flex"})}function Re(e,t){t.querySelectorAll(".action").forEach(o=>{const s=o.classList[1],c=i(e,`${s}-href`),l=c!==null&&c!=="",r=i(e,`${s}-method`);l&&ze(o,c,r!==null&&r!==""&&r!=="GET"?r:"get",e.closest(".pj-table-wrapper"))})}function ze(e,t,n,o){const s=function(){n!=="get"?b[n.toLowerCase()](t).then(l=>{const r=l.data.message,g=l.data.title??"OK",J=l.data.level??"info";S(r,g,J)}).catch(()=>{console.log("Error during action")}):window.location.href=t,a(o)};Ke(e.closest(".table-actions"),s),e.addEventListener("click",s)}function Ke(e,t){e.addEventListener("close",function(){e.querySelectorAll(".action").forEach(o=>{o.removeEventListener("click",t)})})}function Qe(e,t){document.querySelector("body").addEventListener("click",function n(o){o.target instanceof Element&&(o.target.classList.contains("hellip")||o.target.closest(".hellip")!==null||(t.style.display="none",setTimeout(()=>{e.closest("tr").classList.remove("active-actions")},100)),document.querySelector("body").removeEventListener("click",n),t.dispatchEvent(new Event("close")))})}function Je(e){Xe(e),Ye(e),e.querySelectorAll(".table-options .sorter-wrapper .option").forEach(n=>{n.addEventListener("click",function(){this.classList.contains("selected")||a(e,{column:Ve(this),order:"asc"})})})}function z(e){if(!$(e))return null;const t=e.querySelector(".table-options .sort-values .option");return i(t,"column")}function Ge(e){if(!$(e))return null;const t=e.querySelector(".table-options .sort-values .option");return i(t,"order")}function Ve(e){return i(e,"column")}function Xe(e){if(!$(e))return;e.querySelector(".table-options .sort-values .option .sort-order").addEventListener("click",function(){a(e,{column:z(e),order:Ze(this.closest(".option"))})})}function Ye(e){if(!$(e))return;e.querySelector(".table-options .sort-values .option .close-button").addEventListener("click",function(){a(e,{column:"",order:"asc",deleteSort:!0})})}function Ze(e){return i(e,"order")==="asc"?"desc":"asc"}function $(e){const t=e.querySelector(".table-options");return t===null?!1:t.querySelector(".table-options .sort-values")!==null}function P(e,t=null,n=null){t=t??"primary";const o=n===null?"":` id="${n}"`;return`<button class="pj-btn ${t}"${o}>${e}</button>`}class We{title;body="";footer="";id=null;complex;buttonId=0;callbacks=[];constructor(t=!1){this.complex=t}open(){const t=this.getModalHTML();C(t),this.bindClose(t),this.bindCallbacks(),this.bindModalBody(t),this.resetModalDefaults()}close(){ee("body > .overlay")}resetModalDefaults(){this.footer="",this.buttonId=0}bindCallbacks(){for(const t of this.callbacks){const[n,o]=t;document.querySelector(`#${n}`).addEventListener("click",()=>{o()!==!1&&this.close()})}}bindModalBody(t){F(t)}getModalHTML(){const t=["modal"],n=h("div",null,{class:["overlay"]});let o="";this.complex&&t.push("complex"),this.id!==null&&(o=` id="${this.id}"`);let s=`<div class="${t.join(" ")}"${o}>`;return s+=_(),s+=this.getTitleHTML(),s+=this.getBodyHTML(),s+=this.getFooterHTML(),n.innerHTML=s,n}bindClose(t){t.querySelector(".close-button").addEventListener("click",this.close);const n=this;document.addEventListener("keydown",function o(s){s.key==="Escape"&&(n.close(),document.removeEventListener("keydown",o))})}getFooterHTML(){return this.footer===""?"":`<div class="footer">${this.footer}</div>`}setFooterButton(t,n=null,o=null){this.buttonId++;const s=`modal-button-${this.buttonId}`;return this.footer+=P(t,o,s),n!==null&&this.setCallback(s,n),this}setFooterButtonAsSubmit(t,n=null){this.buttonId++;const o=`modal-button-${this.buttonId}`;return this.footer+=P(t,n,o),this.setCallback(o,function(){const s=document.querySelector(".modal .body form");new B(s).submitWithButton(document.querySelector(`.modal #${o}`))}),this}getTitleHTML(){return`<div class="header"><p${this.complex?'class="l"':""}>${this.title}</p></div>`}setTitle(t){return this.title=t,this}getBodyHTML(){return`<div class="body">${this.body}</div>`}setBody(t){return this.body=t,this}setId(t=null){return this.id=t,this}setCallback(t,n){this.callbacks.push([t,n])}}let L=null;function et(e){nt(e),e.querySelectorAll(".table-options .filter-options-wrapper .option").forEach(n=>{n.addEventListener("click",async function(){await ot(this),ct(e,this)})})}function tt(e){return{filters:T(e),deleteFilters:!1}}function nt(e){e.querySelectorAll(".table-options .filter-values .values .option").forEach(n=>{n.querySelector(".close-button").addEventListener("click",function(){n.remove();const o=e.querySelectorAll(".table-options .filter-values .values .option").length;a(e,{filterCriteria:{filters:T(e),deleteFilters:o===0}})})})}async function ot(e){const t=i(e,"type");let n=`${te()}/${le.replace("{type}",t)}`;if(t==="date"||t==="number"){const l=i(e,"from"),r=i(e,"to");l!==null&&(n+=`?from=${l}`),r!==null&&(n+=m(n)?`&to=${r}`:`?to=${r}`)}if(t==="json"){const l=i(e,"json-path");l!==null&&(n+=`?jsonPath=${l}`)}const o=await b.get(n).then(l=>l.data).catch(()=>{S(d.t("errors.400.message"),d.t("errors.400.title"),"error")});if(!o)return;const s=`${d.t("table.filter.title")} - ${e.querySelector("span").textContent}`;let c=o.modal;t==="select"&&(c+=await st(e)),L=new We(!0),L.setId("filter-modal").setTitle(s).setBody(c).setFooterButton(d.t("table.filter.title")).open()}async function st(e){const t=i(e,"options-url");return(await b.get(t)).data.htmlComponent}function ct(e,t){document.getElementById("filter-modal").querySelector(".footer button").addEventListener("click",function(){a(e,{filterCriteria:{filters:[...T(e),it(t)],deleteFilters:!1}}),L.close()})}function it(e){const t=document.getElementById("filter-modal"),n=i(e,"type"),o=i(e,"column");try{switch(n){case"text":return rt(t,o);case"number":return ht(t,o);case"date":return pt(t,o);case"select":return yt(t,o);case"json":return gt(t,o)}}catch(s){console.error(s)}}function lt(e){const t=i(e,"type"),n=i(e,"column");try{switch(t){case"text":return ut(e,n);case"number":return at(e,n);case"date":return dt(e,n);case"select":return ft(e,n);case"json":return mt(e,n)}}catch(o){console.error(o)}}function rt(e,t){const n=p(e.querySelector(".pj-dropdown")),o=e.querySelector('[name="filter_value"]');if(!["contains","not_contains","equals","not_equals","starts_with","ends_with"].includes(n))throw new Error("Invalid filter type");return{column:t,type:"text",filterType:n,value:o.value}}function ut(e,t){const n=i(e,"operator"),o=i(e,"value");return{column:t,type:"text",filterType:n,value:o}}function at(e,t){let n=i(e,"from"),o=i(e,"to");return n!==null&&(n=parseFloat(n)),o!==null&&(o=parseFloat(o)),{column:t,type:"number",from:n,to:o}}function dt(e,t){const n=i(e,"from"),o=i(e,"to");return{column:t,type:"date",from:n,to:o}}function ft(e,t){const n=i(e,"value");return{column:t,type:"select",value:n}}function mt(e,t){const n=i(e,"operator"),o=i(e,"json-path"),s=i(e,"value");return{column:t,type:"json",filterType:n,jsonPath:o||null,value:s}}function ht(e,t){const n=e.querySelector('[name="filter_value_from"]'),o=e.querySelector('[name="filter_value_to"]');if(n.value===""&&o.value==="")throw new Error("No filter value");let s=parseFloat(n.value),c=parseFloat(o.value);return n.value===""&&(s=null),o.value===""&&(c=null),{column:t,type:"number",from:s,to:c}}function pt(e,t){const n=e.querySelector('[name="filter_value_from"]'),o=e.querySelector('[name="filter_value_to"]');if(n.value===""&&o.value==="")throw new Error("No filter value");let s=n.value,c=o.value;return n.value===""&&(s=null),o.value===""&&(c=null),{column:t,type:"date",from:s,to:c}}function yt(e,t){return{column:t,type:"select",value:p(e.querySelector(".pj-dropdown"))}}function gt(e,t){const n=p(e.querySelector(".pj-dropdown")),o=e.querySelector('[name="json_path"]'),s=e.querySelector('[name="filter_value"]');if(!["contains","not_contains","equals","not_equals","starts_with","ends_with"].includes(n))throw new Error("Invalid filter type");return{column:t,type:"json",filterType:n,jsonPath:o.value||null,value:s.value}}function T(e){const t=e.querySelectorAll(".table-options .filter-values .values .option");let n=[];return t.forEach(o=>{n.push(lt(o))}),n}function vt(e=null){let t=Array.from(document.querySelectorAll(".pj-table-wrapper"));e!==null&&(t=[e]),t.forEach(n=>{St(n),K(n)})}function a(e,t={}){e.dispatchEvent(new CustomEvent("update",{detail:t}))}function St(e){e.addEventListener("update",function(t){const n=bt(e,t),o=wt(e,t),s=kt(e,t);He(e),$t(e,n,o,s).then(()=>{K(e),F(e)})})}function K(e){be(e),De(e),re(e),ve(e),Me(e),Je(e),et(e),k(e),we(e.id)}function bt(e,t){let n=t.detail.page,o=t.detail.pageSize;return n===void 0&&(n=ue(e)),o===void 0&&(o=Se(e)),{page:n,pageSize:o}}function wt(e,t){let n=t.detail.column,o=t.detail.order;const s=t.detail.deleteSort??!1;return n===void 0&&(n=z(e)),o===void 0&&(o=Ge(e)??"asc"),{column:n,order:o,deleteSort:s}}function kt(e,t){let n=t.detail.filterCriteria;return n===void 0&&(n=tt(e)),n}async function $t(e,t=null,n=null,o=null){const s=qt(e,t,n,o),c=await Et(s);Lt(e,c.head),Ct(e,c.body),c.pagination&&Ft(e,c.pagination),c.options&&At(e,c.options)}function qt(e,t=null,n=null,o=null){let s=i(e,"html-parts-url");return t!==null&&(s=Tt(s,t)),n!==null&&(s=jt(s,n)),o!==null&&(s=It(s,o)),s}function Et(e){return new Promise(t=>{b.get(e).then(n=>{t(n.data)}).catch(()=>console.log("Error while loading table parts"))})}function Lt(e,t){const n=e.querySelector("thead");n.innerHTML=t}function Ct(e,t){const n=e.querySelector("tbody");n.innerHTML=t}function Ft(e,t){const n=e.closest(".pj-table-wrapper").querySelector(".pagination");n.outerHTML=t}function At(e,t){const n=e.querySelector(".table-options");n.outerHTML=t}function Tt(e,t){return m(e)?e+="&":e+="?",e+`${D}=${t.page}&${oe}=${t.pageSize}`}function jt(e,t){return t.column===null?e:(m(e)?e+="&":e+="?",e+`${se}=${t.column}&${ce}=${t.order}&${ie}=${t.deleteSort}`)}function It(e,t){if(t?.deleteFilters&&(m(e)?e+="&":e+="?",e=e+`${j}=${t.deleteFilters}`),t===null||t.filters.length===0)return e;m(e)?e+="&":e+="?";let n=[],o=0;for(const s of t.filters)n.push(Ot(s,o)),o++;return e+n.join("&")+`&${j}=${t.deleteFilters}`}function Ot(e,t){switch(e.type){case"text":return Pt(e,t);case"number":case"date":return Mt(e,t);case"select":return xt(e,t);case"json":return Bt(e,t)}}function Pt(e,t){return`${u}[${e.column}][${t}][value]=${e.value}
        &${u}[${e.column}][${t}][operator]=${e.filterType}
        &${u}[${e.column}][${t}][type]=${e.type}`}function Mt(e,t){if(e.from===null&&e.to===null)return"";const n=`&${u}[${e.column}][${t}][type]=${e.type}`;return e.from===null?`${u}[${e.column}][${t}][to]=${e.to}${n}`:e.to===null?`${u}[${e.column}][${t}][from]=${e.from}${n}`:`${u}[${e.column}][${t}][from]=${e.from}
        &${u}[${e.column}][${t}][to]=${e.to}${n}`}function xt(e,t){return`${u}[${e.column}][${t}][value]=${e.value}
        &${u}[${e.column}][${t}][type]=${e.type}`}function Bt(e,t){return`${u}[${e.column}][${t}][value]=${e.value}
        &${u}[${e.column}][${t}][operator]=${e.filterType}
        &${u}[${e.column}][${t}][jsonPath]=${e.jsonPath??""}
        &${u}[${e.column}][${t}][type]=${e.type}`}function _t(e){const t=h("div",null,{class:["pj-photo-preview"]});return t.appendChild(e),t.innerHTML+=`<div class="delete-button">${_()}</div>`,t}function Dt(){document.querySelectorAll(".pj-photo-uploader").forEach(t=>{Ht(t),t.querySelectorAll(".previews .pj-photo-preview").forEach(o=>{const s=o.querySelector("img"),c=i(s,"file-name");Q(o,t,c)})})}function Ht(e){const t=e.querySelector('input[type="file"]'),n=e.querySelector(".previews");t.addEventListener("change",o=>{const s=o.target.files;for(const c of s){if(!Nt(c)){alert(`Invalid file type: ${c.type}`);continue}const l=_t(h("img",null,{src:URL.createObjectURL(c),alt:c.name}));C(l,n),Q(l,e,c)}})}function Q(e,t,n){const o=e.querySelector(".delete-button"),s=t.querySelector('input[type="file"]');o.addEventListener("click",()=>{e.closest(".pj-photo-preview").remove();const l=typeof n=="string"?n:n.name,r=h("input",null,{type:"hidden",name:`deleted_files_${s.name}[]`,value:l});t.appendChild(r)})}function Nt(e){return["image/apng","image/bmp","image/gif","image/jpeg","image/pjpeg","image/png","image/svg+xml","image/tiff","image/webp","image/x-icon"].includes(e.type)}const f=document.querySelector(".navigation .user .button"),v=document.querySelector(".user-items");ne();vt();F();Dt();const Ut=document.querySelector("#article-form");Ut||new B().bindSubmit();f&&f.addEventListener("click",()=>{v.classList.contains("active")||(v.classList.add("active"),f.classList.add("active"),setTimeout(()=>{Rt()},0))});function Rt(){document.querySelector("body").addEventListener("click",function e(t){const n=t.target,o=v===n.closest(".user-items");f&&!o&&(v.classList.remove("active"),f.classList.remove("active"),document.querySelector("body").removeEventListener("click",e))})}const q=document.querySelector(".logout-form a");q&&q.addEventListener("click",e=>{e.preventDefault(),q.closest("form").submit()});const M=document.querySelectorAll(".navigation .item .arrow-wrapper");M&&M.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.querySelector(".arrow"),o=n.closest(".item-wrapper");o.classList.toggle("active"),o.classList.contains("active")?(n.classList.remove("down"),n.classList.add("up")):(n.classList.remove("up"),n.classList.add("down"))})});
