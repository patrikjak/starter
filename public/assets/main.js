import{f as V,c as m,s as $,g as i,a as G,D as M,b as q,r as J,d as X,n as g,i as d,e as Y,h as Z,j as v,k as W,F as B,l as P,m as ee,u as f,o as te}from"./Form.js";const D="page",ne="pageSize",oe="sort",se="order",ce="deleteSort",u="filter",T="deleteFilters",ie="pjutils/table/filter-form/{type}";function le(e){e.querySelectorAll(".pagination").forEach(n=>{ue(e,n)})}function re(e){const t=e.querySelector(".pagination a.active");return parseInt(t.querySelector(".page-number").textContent)}function ue(e,t){t.querySelectorAll(".link").forEach(o=>{o.addEventListener("click",async function(s){s.preventDefault(),de(o)&&a(e,{page:ae(o.getAttribute("href"))})})})}function ae(e){const t=V(D,e);return t===null?null:parseInt(t)}function de(e){return!e.classList.contains("active")&&!e.classList.contains("disabled")}function C(e=document){e.querySelectorAll(".pj-dropdown").forEach(function(t){I(t),fe(t),he(t),window.addEventListener("resize",function(){I(t)})})}function S(e){return i(e.querySelector(".chosen"),"value")}function fe(e){const t=e.querySelector(".arrow-wrapper");e.querySelector(".chosen").addEventListener("click",function(){t.querySelector(".arrow").classList.contains("up")||(pe(e),setTimeout(function(){me(e)},0))})}function me(e){document.addEventListener("click",function t(n){n.target instanceof Element&&(H(e),document.removeEventListener("click",t))})}function he(e){e.querySelectorAll(".all-items .pj-dropdown-item").forEach(function(n){n.addEventListener("click",function(){const o=e.querySelector(".chosen"),s=i(o,"value"),c=i(n,"value");o.querySelector(".label").textContent=n.textContent,G(o,"value",c),H(e),s!==c&&e.dispatchEvent(new Event("change"))})})}function H(e){const t=e.querySelector(".arrow"),n=e.querySelector(".all-items");t.classList.add("down"),t.classList.remove("up"),n.classList.add(q),J(n,[M,q,"show"])}function pe(e){const t=e.querySelector(".arrow"),n=e.querySelector(".all-items");t.classList.remove("down"),t.classList.add("up"),n.classList.add(M,"show"),n.classList.remove(q)}function I(e){const t=m("div",null,{class:["hidden-items"]});e.querySelectorAll(".all-items .pj-dropdown-item").forEach(function(c){t.appendChild(c.cloneNode(!0))}),ye(),$(t);const o=t.scrollWidth+54,s=e.querySelector(".dropdown-wrapper");s.style.width=`${o}px`}function ye(e=document){e.querySelectorAll(".hidden-items").forEach(function(t){t.remove()})}function ge(e){const t=e.querySelector(".page-size");if(!t)return;const n=t.querySelector(".pj-dropdown");n.addEventListener("change",async function(){a(e,{pageSize:parseInt(S(n))})})}function ve(e){const n=e.querySelector(".page-size").querySelector(".pj-dropdown");return parseInt(S(n))}const j=new Set;function Se(e){const t=e.querySelector("thead .pj-checkbox input"),n=e.querySelectorAll("tbody .pj-checkbox input");t===null||n.length===0||(t.checked=b(n),we(t),ke(t,n),Te(e))}function b(e){for(const t of e)if(t.checked===!1)return!1;return!0}function be(e){const t=h(e);if(t.length===0)return;const n=document.querySelector(`.pj-table-wrapper#${e}`),o=n.querySelector("thead .pj-checkbox input"),s=n.querySelectorAll("tbody .pj-checkbox input");s.forEach(c=>{const l=c.closest("tr").id;t.includes(l)&&(c.checked=!0,_(c,!0))}),b(s)&&(o.checked=!0)}function w(e){const t=e.querySelector(".bulk-actions-wrapper");t!==null&&(N(e.id)>0?t.classList.remove("hidden"):t.classList.add("hidden"),Ae(e))}function we(e){const t=e.closest(".pj-table-wrapper");e.closest(".pj-checkbox").addEventListener("click",()=>{const n=t.querySelectorAll("tbody .pj-checkbox input");qe(e,n)})}function ke(e,t){const n=e.closest(".pj-table-wrapper");t.forEach(o=>{o.closest(".pj-checkbox").addEventListener("click",()=>{A(o,!o.checked),w(n),e.checked=b(t)})})}function qe(e,t){const n=e.closest(".pj-table-wrapper"),o=b(t);e.checked=!o,t.forEach(s=>{A(s,!o)}),w(n)}function _(e,t){const n=e.closest("tr");t?n.classList.add("active"):n.classList.remove("active")}function A(e,t){Le(e,t),Ee(e)}function Le(e,t){e!==null&&(e.checked=t,_(e,t))}function N(e){return h(e).length}function Ee(e){const t=e.closest(".pj-table-wrapper").id,n=e.checked,o=e.closest("tr").id;n?$e(t,o):Ce(t,o)}function $e(e,t){const n=h(e);n.includes(t)||(n.push(t),sessionStorage.setItem(e,JSON.stringify(n)))}function Ce(e,t){const n=h(e),o=n.indexOf(t);o!==-1&&n.splice(o,1),sessionStorage.setItem(e,JSON.stringify(n))}function Ae(e){const t=e.querySelector(".bulk-actions-wrapper .selected .count");t!==null&&(t.textContent=N(e.id).toString())}function h(e){return JSON.parse(sessionStorage.getItem(e)||"[]")}function Fe(e){sessionStorage.removeItem(e)}function Te(e){const t=e.querySelector(".bulk-actions-wrapper");if(t===null)return;t.querySelectorAll(".bulk-action button").forEach(o=>{j.has(o)||(j.add(o),o.addEventListener("click",function(){Ie(o,e)}))})}function Ie(e,t){const n=h(t.id);if(n.length===0)return;const o=i(e,"action"),s=i(e,"method").toLowerCase();X(o,s,je(n)).then(c=>{Oe(c,t,n)}).catch(c=>{console.log(c),g(c?.data?.message??d.t("errors.default.message"),"Ooops!","error")})}function je(e){const t=new FormData;return e.forEach(n=>{t.append("bulkActionsIds[]",n)}),t}function Oe(e,t,n){const o=t.querySelector("thead .pj-checkbox input");o.checked=!1,n.forEach(s=>{t.querySelector(`tr[id='${s}'] .pj-checkbox input`)!==null&&A(t.querySelector(`tr[id='${s}'] .pj-checkbox input`),!1)}),Fe(t.id),w(t),g(e.message,"Super","success")}function xe(e){e.querySelectorAll(".table-options .controller").forEach(n=>{n.addEventListener("click",function(){Me(e),Be(this),Pe(this)})})}function U(e){e.classList.remove("opened")}function Me(e){e.querySelectorAll(".table-options .controller").forEach(n=>{U(n)})}function Be(e){e.classList.add("opened")}function Pe(e){document.addEventListener("click",function t(n){if(!(n.target instanceof Element))return;const o=n.target.closest(".controller")!==null,s=n.target.closest(".overlay")!==null;o||s||(U(e),document.removeEventListener("click",t))})}function De(e){e.querySelector(".table-actions")&&e.querySelectorAll("tr td.actions").forEach(n=>{n.querySelector(".hellip").addEventListener("click",()=>{_e(n,e.querySelector(".table-actions"))})})}function He(e){const t=e.querySelector(".table-actions");t!==null&&Y(t,e.querySelector(".pj-table"))}function _e(e,t){t.style.display="inline-block",t.style.position="absolute",e.closest("tr").classList.add("active-actions"),Ne(e,t),Ue(e,t);const o=e.closest(".table-wrapper"),s=o.clientWidth,c=e.getBoundingClientRect(),l=t.getBoundingClientRect(),r=o.getBoundingClientRect(),p=s-c.width-l.width;t.style.top=c.top-r.top+c.height/2/2+"px",t.style.left=p+"px",setTimeout(()=>{Ke(e,t)},0)}function Ne(e,t){const n=e.closest("tr"),o=i(n,"hidden-actions");let s=[];o!==null&&o!==""&&(s=o.split(",")),t.querySelectorAll(".action").forEach(l=>{if(Z(s)){l.style.display="flex";return}for(const r of s)l.style.display=l.classList.contains(r)?"none":"flex"})}function Ue(e,t){t.querySelectorAll(".action").forEach(o=>{const s=o.classList[1],c=i(e,`${s}-href`),l=c!==null&&c!=="",r=i(e,`${s}-method`);l&&Re(o,c,r!==null&&r!==""&&r!=="GET"?r:"get",e.closest(".pj-table-wrapper"))})}function Re(e,t,n,o){const s=function(){n!=="get"?v[n.toLowerCase()](t).then(l=>{const r=l.data.message,p=l.data.title??"OK",Q=l.data.level??"info";g(r,p,Q)}).catch(()=>{console.log("Error during action")}):window.location.href=t,a(o)};ze(e.closest(".table-actions"),s),e.addEventListener("click",s)}function ze(e,t){e.addEventListener("close",function(){e.querySelectorAll(".action").forEach(o=>{o.removeEventListener("click",t)})})}function Ke(e,t){document.querySelector("body").addEventListener("click",function n(o){o.target instanceof Element&&(o.target.classList.contains("hellip")||o.target.closest(".hellip")!==null||(t.style.display="none",setTimeout(()=>{e.closest("tr").classList.remove("active-actions")},100)),document.querySelector("body").removeEventListener("click",n),t.dispatchEvent(new Event("close")))})}function Qe(e){Je(e),Xe(e),e.querySelectorAll(".table-options .sorter-wrapper .option").forEach(n=>{n.addEventListener("click",function(){this.classList.contains("selected")||a(e,{column:Ge(this),order:"asc"})})})}function R(e){if(!k(e))return null;const t=e.querySelector(".table-options .sort-values .option");return i(t,"column")}function Ve(e){if(!k(e))return null;const t=e.querySelector(".table-options .sort-values .option");return i(t,"order")}function Ge(e){return i(e,"column")}function Je(e){if(!k(e))return;e.querySelector(".table-options .sort-values .option .sort-order").addEventListener("click",function(){a(e,{column:R(e),order:Ye(this.closest(".option"))})})}function Xe(e){if(!k(e))return;e.querySelector(".table-options .sort-values .option .close-button").addEventListener("click",function(){a(e,{column:"",order:"asc",deleteSort:!0})})}function Ye(e){return i(e,"order")==="asc"?"desc":"asc"}function k(e){const t=e.querySelector(".table-options");return t===null?!1:t.querySelector(".table-options .sort-values")!==null}function O(e,t=null,n=null){t=t??"primary";const o=n===null?"":` id="${n}"`;return`<button class="pj-btn ${t}"${o}>${e}</button>`}class Ze{title;body="";footer="";id=null;complex;buttonId=0;callbacks=[];constructor(t=!1){this.complex=t}open(){const t=this.getModalHTML();$(t),this.bindClose(t),this.bindCallbacks(),this.bindModalBody(t),this.resetModalDefaults()}close(){W("body > .overlay")}resetModalDefaults(){this.footer="",this.buttonId=0}bindCallbacks(){for(const t of this.callbacks){const[n,o]=t;document.querySelector(`#${n}`).addEventListener("click",()=>{o()!==!1&&this.close()})}}bindModalBody(t){C(t)}getModalHTML(){const t=["modal"],n=m("div",null,{class:["overlay"]});let o="";this.complex&&t.push("complex"),this.id!==null&&(o=` id="${this.id}"`);let s=`<div class="${t.join(" ")}"${o}>`;return s+=P(),s+=this.getTitleHTML(),s+=this.getBodyHTML(),s+=this.getFooterHTML(),n.innerHTML=s,n}bindClose(t){t.querySelector(".close-button").addEventListener("click",this.close);const n=this;document.addEventListener("keydown",function o(s){s.key==="Escape"&&(n.close(),document.removeEventListener("keydown",o))})}getFooterHTML(){return this.footer===""?"":`<div class="footer">${this.footer}</div>`}setFooterButton(t,n=null,o=null){this.buttonId++;const s=`modal-button-${this.buttonId}`;return this.footer+=O(t,o,s),n!==null&&this.setCallback(s,n),this}setFooterButtonAsSubmit(t,n=null){this.buttonId++;const o=`modal-button-${this.buttonId}`;return this.footer+=O(t,n,o),this.setCallback(o,function(){const s=document.querySelector(".modal .body form");new B(s).submitWithButton(document.querySelector(`.modal #${o}`))}),this}getTitleHTML(){return`<div class="header"><p${this.complex?'class="l"':""}>${this.title}</p></div>`}setTitle(t){return this.title=t,this}getBodyHTML(){return`<div class="body">${this.body}</div>`}setBody(t){return this.body=t,this}setId(t=null){return this.id=t,this}setCallback(t,n){this.callbacks.push([t,n])}}let L=null;function We(e){tt(e),e.querySelectorAll(".table-options .filter-options-wrapper .option").forEach(n=>{n.addEventListener("click",async function(){await nt(this),st(e,this)})})}function et(e){return{filters:F(e),deleteFilters:!1}}function tt(e){e.querySelectorAll(".table-options .filter-values .values .option").forEach(n=>{n.querySelector(".close-button").addEventListener("click",function(){n.remove();const o=e.querySelectorAll(".table-options .filter-values .values .option").length;a(e,{filterCriteria:{filters:F(e),deleteFilters:o===0}})})})}async function nt(e){const t=i(e,"type");let n=`${ee()}/${ie.replace("{type}",t)}`;if(t==="date"||t==="number"){const l=i(e,"from"),r=i(e,"to");l!==null&&(n+=`?from=${l}`),r!==null&&(n+=f(n)?`&to=${r}`:`?to=${r}`)}const o=await v.get(n).then(l=>l.data).catch(()=>{g(d.t("errors.400.message"),d.t("errors.400.title"),"error")});if(!o)return;const s=`${d.t("table.filter.title")} - ${e.querySelector("span").textContent}`;let c=o.modal;t==="select"&&(c+=await ot(e)),L=new Ze(!0),L.setId("filter-modal").setTitle(s).setBody(c).setFooterButton(d.t("table.filter.title")).open()}async function ot(e){const t=i(e,"options-url");return(await v.get(t)).data.htmlComponent}function st(e,t){document.getElementById("filter-modal").querySelector(".footer button").addEventListener("click",function(){a(e,{filterCriteria:{filters:[...F(e),ct(t)],deleteFilters:!1}}),L.close()})}function ct(e){const t=document.getElementById("filter-modal"),n=i(e,"type"),o=i(e,"column");try{switch(n){case"text":return lt(t,o);case"number":return ft(t,o);case"date":return mt(t,o);case"select":return ht(t,o)}}catch(s){console.error(s)}}function it(e){const t=i(e,"type"),n=i(e,"column");try{switch(t){case"text":return rt(e,n);case"number":return ut(e,n);case"date":return at(e,n);case"select":return dt(e,n)}}catch(o){console.error(o)}}function lt(e,t){const n=S(e.querySelector(".pj-dropdown")),o=e.querySelector('[name="filter_value"]');if(!["contains","not_contains","equals","not_equals","starts_with","ends_with"].includes(n))throw new Error("Invalid filter type");return{column:t,type:"text",filterType:n,value:o.value}}function rt(e,t){const n=i(e,"operator"),o=i(e,"value");return{column:t,type:"text",filterType:n,value:o}}function ut(e,t){let n=i(e,"from"),o=i(e,"to");return n!==null&&(n=parseFloat(n)),o!==null&&(o=parseFloat(o)),{column:t,type:"number",from:n,to:o}}function at(e,t){const n=i(e,"from"),o=i(e,"to");return{column:t,type:"date",from:n,to:o}}function dt(e,t){const n=i(e,"value");return{column:t,type:"select",value:n}}function ft(e,t){const n=e.querySelector('[name="filter_value_from"]'),o=e.querySelector('[name="filter_value_to"]');if(n.value===""&&o.value==="")throw new Error("No filter value");let s=parseFloat(n.value),c=parseFloat(o.value);return n.value===""&&(s=null),o.value===""&&(c=null),{column:t,type:"number",from:s,to:c}}function mt(e,t){const n=e.querySelector('[name="filter_value_from"]'),o=e.querySelector('[name="filter_value_to"]');if(n.value===""&&o.value==="")throw new Error("No filter value");let s=n.value,c=o.value;return n.value===""&&(s=null),o.value===""&&(c=null),{column:t,type:"date",from:s,to:c}}function ht(e,t){return{column:t,type:"select",value:S(e.querySelector(".pj-dropdown"))}}function F(e){const t=e.querySelectorAll(".table-options .filter-values .values .option");let n=[];return t.forEach(o=>{n.push(it(o))}),n}function pt(e=null){let t=Array.from(document.querySelectorAll(".pj-table-wrapper"));e!==null&&(t=[e]),t.forEach(n=>{yt(n),z(n)})}function a(e,t={}){e.dispatchEvent(new CustomEvent("update",{detail:t}))}function yt(e){e.addEventListener("update",function(t){const n=gt(e,t),o=vt(e,t),s=St(e,t);He(e),bt(e,n,o,s).then(()=>{z(e),C(e)})})}function z(e){Se(e),De(e),le(e),ge(e),xe(e),Qe(e),We(e),w(e),be(e.id)}function gt(e,t){let n=t.detail.page,o=t.detail.pageSize;return n===void 0&&(n=re(e)),o===void 0&&(o=ve(e)),{page:n,pageSize:o}}function vt(e,t){let n=t.detail.column,o=t.detail.order;const s=t.detail.deleteSort??!1;return n===void 0&&(n=R(e)),o===void 0&&(o=Ve(e)??"asc"),{column:n,order:o,deleteSort:s}}function St(e,t){let n=t.detail.filterCriteria;return n===void 0&&(n=et(e)),n}async function bt(e,t=null,n=null,o=null){const s=wt(e,t,n,o),c=await kt(s);qt(e,c.head),Lt(e,c.body),c.pagination&&Et(e,c.pagination),c.options&&$t(e,c.options)}function wt(e,t=null,n=null,o=null){let s=i(e,"html-parts-url");return t!==null&&(s=Ct(s,t)),n!==null&&(s=At(s,n)),o!==null&&(s=Ft(s,o)),s}function kt(e){return new Promise(t=>{v.get(e).then(n=>{t(n.data)}).catch(()=>console.log("Error while loading table parts"))})}function qt(e,t){const n=e.querySelector("thead");n.innerHTML=t}function Lt(e,t){const n=e.querySelector("tbody");n.innerHTML=t}function Et(e,t){const n=e.closest(".pj-table-wrapper").querySelector(".pagination");n.outerHTML=t}function $t(e,t){const n=e.querySelector(".table-options");n.outerHTML=t}function Ct(e,t){return f(e)?e+="&":e+="?",e+`${D}=${t.page}&${ne}=${t.pageSize}`}function At(e,t){return t.column===null?e:(f(e)?e+="&":e+="?",e+`${oe}=${t.column}&${se}=${t.order}&${ce}=${t.deleteSort}`)}function Ft(e,t){if(t?.deleteFilters&&(f(e)?e+="&":e+="?",e=e+`${T}=${t.deleteFilters}`),t===null||t.filters.length===0)return e;f(e)?e+="&":e+="?";let n=[],o=0;for(const s of t.filters)n.push(Tt(s,o)),o++;return e+n.join("&")+`&${T}=${t.deleteFilters}`}function Tt(e,t){switch(e.type){case"text":return It(e,t);case"number":case"date":return jt(e,t);case"select":return Ot(e,t)}}function It(e,t){return`${u}[${e.column}][${t}][value]=${e.value}
        &${u}[${e.column}][${t}][operator]=${e.filterType}
        &${u}[${e.column}][${t}][type]=${e.type}`}function jt(e,t){if(e.from===null&&e.to===null)return"";const n=`&${u}[${e.column}][${t}][type]=${e.type}`;return e.from===null?`${u}[${e.column}][${t}][to]=${e.to}${n}`:e.to===null?`${u}[${e.column}][${t}][from]=${e.from}${n}`:`${u}[${e.column}][${t}][from]=${e.from}
        &${u}[${e.column}][${t}][to]=${e.to}${n}`}function Ot(e,t){return`${u}[${e.column}][${t}][value]=${e.value}
        &${u}[${e.column}][${t}][type]=${e.type}`}function xt(e){const t=m("div",null,{class:["pj-photo-preview"]});return t.appendChild(e),t.innerHTML+=`<div class="delete-button">${P()}</div>`,t}function Mt(){document.querySelectorAll(".pj-photo-uploader").forEach(t=>{Bt(t),t.querySelectorAll(".previews .pj-photo-preview").forEach(o=>{const s=o.querySelector("img"),c=i(s,"file-name");K(o,t,c)})})}function Bt(e){const t=e.querySelector('input[type="file"]'),n=e.querySelector(".previews");t.addEventListener("change",o=>{const s=o.target.files;for(const c of s){if(!Pt(c)){alert(`Invalid file type: ${c.type}`);continue}const l=xt(m("img",null,{src:URL.createObjectURL(c),alt:c.name}));$(l,n),K(l,e,c)}})}function K(e,t,n){const o=e.querySelector(".delete-button"),s=t.querySelector('input[type="file"]');o.addEventListener("click",()=>{e.closest(".pj-photo-preview").remove();const l=typeof n=="string"?n:n.name,r=m("input",null,{type:"hidden",name:`deleted_files_${s.name}[]`,value:l});t.appendChild(r)})}function Pt(e){return["image/apng","image/bmp","image/gif","image/jpeg","image/pjpeg","image/png","image/svg+xml","image/tiff","image/webp","image/x-icon"].includes(e.type)}const E=document.querySelector(".navigation .user .button"),y=document.querySelector(".user-items");te();pt();C();Mt();const Dt=document.querySelector("#article-form");Dt||new B().bindSubmit();E.addEventListener("click",()=>{y.classList.contains("active")||(y.classList.add("active"),E.classList.add("active"),setTimeout(()=>{Ht()},0))});function Ht(){document.querySelector("body").addEventListener("click",function e(t){const n=t.target;y===n.closest(".user-items")||(y.classList.remove("active"),E.classList.remove("active"),document.querySelector("body").removeEventListener("click",e))})}const x=document.querySelector(".logout-form a");x.addEventListener("click",e=>{e.preventDefault(),x.closest("form").submit()});const _t=document.querySelectorAll(".navigation .item .arrow-wrapper");_t.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.querySelector(".arrow"),o=n.closest(".item-wrapper");o.classList.toggle("active"),o.classList.contains("active")?(n.classList.remove("down"),n.classList.add("up")):(n.classList.remove("up"),n.classList.add("down"))})});
